<div class=" col-md-6 col-lg-4 mb-5">
  <div class="card">

    <div class="card-img-top">

    <div style='width: 100%;'>
      <div id="map-<%= note.id %>" style='width: 100%; height:220px;'></div>
    </div>

    <%
    @note = note
    @hash_each = Gmaps4rails.build_markers(note) do |note, marker|
      marker.lat note.latitude
      marker.lng note.longitude
      marker.infowindow render(partial: "shared/infowindow", locals: { note: note })
    end

    %>

    <script type="text/javascript">
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {}, internal: {id: 'map-<%= note.id %>'}}, function(){
      markers = handler.addMarkers(<%=raw @hash_each.to_json %>);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
    });
    </script>
    </div>

    <div class="card-body pt-1">
      <% if note.embassy %>
      <span class="badge badge-pill badge-info mb-2 py-1">大使館掲載情報</span>
      <% end %>
      <% if note.general %>
      <span class="badge badge-pill badge-secondary mb-2 py-1">一般治安・犯罪情報</span>
      <% end %>
      <h5 class="card-title">
        <strong><%= note.crime_category %></strong>
      </h5>
      <% unless note.general %>
      <p class="card-text">
        <i class="fas fa-map-marker-alt text-danger"></i>
        <%= note.address_city_part %>, <%= note.address_country_part%>
        <br>
        <i class="fas fa-calendar-alt text-muted"></i>
        <%= note.occured_at&.strftime('%v')%>
        &nbsp;
        <i class="far fa-clock"></i>
        <%= note.occured_at&.strftime('%R') %>
      </p>
      <% end %>
    </div>
    <ul class="list-group list-group-flush">
    <li class="list-group-item">

    <% if note.profile_age or note.profile_sex or note.profile_type or note.profile_supplement %>
    <h3>
      <i class="fas fa-user-circle"></i>&nbsp;&nbsp;
      <%= note.try(:profile_type) %>
      <% unless note.profile_age.empty? %>&nbsp;&nbsp;<% end %><%= note.try(:profile_age) %>
      <% unless note.profile_sex.empty? %>&nbsp;&nbsp;<% end %><%= note.try(:profile_sex) %>
    </h3>
  <hr>
  <% end %>

    <p><%= note.situation.truncate(200) %></p>
    <hr>
    <div class="d-flex justify-content-between">
      <div>
        <i class="far fa-comment"></i>&nbsp;&nbsp;<%= note.advises.count  %>&nbsp;advises & comments&nbsp;
      </div>
      <div>
      <%= link_to note, class: "btn btn-danger" do %>
      詳細を見る
      <% end %>
    </li>
  </ul>
</div>
</div>
